<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<head>
    <script src="https://code.jquery.com/jquery-1.12.2.min.js"></script>
    <script src="airtable.browser.js"></script>
    <script src="constants.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" </head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <div id="login">
        <h3 class="text-center text-white pt-5">Login form</h3>
        <div class="container">
            <div id="login-row" class="row justify-content-center align-items-center">
                <div id="login-column" class="col-md-6">
                    <div id="login-box" class="col-md-12">
                        <form id="login-form" class="form" action="" method="post">
                            <h3 class="text-center text-info">Login</h3>
                            <div class="form-group">
                                <label for="username" class="text-info">Username:</label><br>
                                <input type="text" name="username" id="username" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="password" class="text-info">Password:</label><br>
                                <input type="password" name="password" id="password" class="form-control">
                            </div>
                            <label for="remember-me" class="text-info"><span>Remember me</span> <span><input
                                        id="remember-me" name="remember-me" type="checkbox"></span></label><br>
                            <div class="text-center form-group">
                                <div class="text-center btn-group" role="group" aria-label="Basic example">
                                    <input type="radio" class="btn-check col-sm-12" name="btnradio" id="btnradio4" autocomplete="off">
                                    <label class="btn btn-outline-primary" for="btnradio4">รับของ</label>

                                    <input type="radio" class="btn-check col-sm-12" name="btnradio" id="btnradio1" autocomplete="off" checked>
                                    <label class="btn btn-outline-primary" for="btnradio1">ผู้ขออนุมัติจัดซื้อ</label>
                                  
                                    <input type="radio" class="btn-check col-sm-12" name="btnradio" id="btnradio2" autocomplete="off">
                                    <label class="btn btn-outline-primary" for="btnradio2">ผู้ตรวจสอบ</label>
                                  
                                    <input type="radio" class="btn-check col-sm-12" name="btnradio" id="btnradio3" autocomplete="off">
                                    <label class="btn btn-outline-primary" for="btnradio3">ผู้อนุมัติ</label>
                                </div>
                            </div>
                            <div class="text-center form-group ">
                                <Button type="button" class="btn btn-primary col-sm-6" onclick="login()">Sign In</Button>
                            </div>


                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>


<script>
    var Airtable = require('airtable');
    // Get a base ID for an instance of art gallery example
    var base = new Airtable({ apiKey: 'keyc1UHWgEK9yNcL1' }).base('appU27vq4tYbLGhaF');
    var user = [];
    var pass = [];
    var permit = [];

    var submit = function(x){
       
        base('permission').select({
            view : 'selectpermission',
            sort: [
                { field: 'E-mail', direction: 'asc' }
            ]
        }).eachPage(function page(records, fetchNextPage) {
            records.forEach(function (record) {
                // console.log(x+"ทดสอบ email :"+record.get("E-mail"));
                // console.log(record.get("E-mail"));
                //  console.log(record.get("E-mail") == document.getElementById("username").value);
                // console.log(document.getElementById("password").value==record.get("password")) ;
                // console.log(record.get("permisssion"));
                // console.log(record.get("permisssion")==="ผู้อนุมัติ");
                if(record.get("E-mail") == document.getElementById("username").value && record.get("password")== document.getElementById("password").value){
                    if(x=="1"){
                        if(record.get("permisssion")=="ผู้ขออนุมัติ"||record.get("permisssion")=="ผู้อนุมัติ"||record.get("permisssion")=="ผู้ตรวจสอบ"){
                            console.log("ยินดีด้วย");
                            window.location.replace("edit.html");
                        }
                    }else if(x=="2"){
                        if(record.get("permisssion")=="ผู้ตรวจสอบ"||record.get("permisssion")=="ผู้อนุมัติ"){
                            console.log("ยินดีด้วย +1");
                            window.location.replace("Check.html");
                        }
                    }else if(x==="3"){
                        if(record.get("permisssion")=="ผู้อนุมัติ"){
                            console.log("ยินดีด้วย+2");
                            window.location.replace("approve.html");
                            return false;
                        }
                    }else if(x=="4"){
                        if(record.get("permisssion")=="ผู้ขออนุมัติ"||record.get("permisssion")=="ผู้อนุมัติ"||record.get("permisssion")=="ผู้ตรวจสอบ"){
                            console.log("ยินดีด้วย");
                            window.location.replace("addtostore.html");
                        }
                    }
                }else console.log("ชื่อหรื่อรหัสไม่ถูกต้อง");
              //   console.log(record.get("E-mail")+":"+document.getElementById("username").value);
              //  console.log(record.get("password")+":"+document.getElementById("password").value);
            });
            
            fetchNextPage();
        }, function done(error) {
            console.log(error);
        });
    }
    
    var login = function(){ 
       
        if(document.getElementById("btnradio1").checked == true){
            submit("1"); 
        }else if(document.getElementById("btnradio2").checked == true){
            submit("2");
        }else if(document.getElementById("btnradio3").checked == true){
            submit("3");
        }else if(document.getElementById("btnradio4").checked == true){
            submit("4");
        }
    }


    
</script>

</html>